<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width" />
    <title>BootStrap Table使用</title>
    <!--@*1、Jquery组件引用*@-->
    <script src="../static/jquery-1.9.1.js"></script>

    <!--@*2、bootstrap组件引用*@-->
    <script src="../static/bootstrap-3.3.7/dist/js/bootstrap.js"></script>
    <link href="../static/bootstrap-3.3.7/dist/css/bootstrap.css" rel="stylesheet" />

    <!--@*3、bootstrap table组件以及中文包的引用*@-->
    <script src="../static/bootstrap-table/dist/bootstrap-table.js"></script>
    <link href="../static/bootstrap-table/dist/bootstrap-table.css" rel="stylesheet" />
    <script src="../static/bootstrap-table/dist/locale/bootstrap-table-zh-CN.js"></script>


    <script src="../static/x-editable/dist/bootstrap3-editable/js/bootstrap-editable.js"></script>
    <link href="../static/x-editable/dist/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet" />

    <script src="../static/bootstrap-table/dist/extensions/editable/bootstrap-table-editable.js"></script>
	<script src="../static/bootstrap-table/dist/locale/bootstrap-table-zh-CN.js"></script>
    
</head>
<body>

<div class="container">
    <h1></h1>
    
	<div id="toolbar">
		<button id="remove_button" class="btn btn-danger" disabled>
			<i class="glyphicon glyphicon-remove"></i> 删除
		</button>
		<button id="add_button" class="btn btn-info">
			<i class="glyphicon glyphicon-plus"></i> 添加
        </button>
        <button id="save_button" class="btn btn-success">
			<i class="glyphicon glyphicon-save"></i> 保存
        </button>
        <button id="mode_button" class="btn btn-default">
            <i class="glyphicon glyphicon-retweet"></i> 本人模式
        </button>
    </div> 
    <table id="table"  
            data-toolbar="#toolbar"
            data-search="true"
            data-show-columns="true"
            data-show-export="true">  
    </table>
</div>

<script>
/*     $("#save_button").click(function(){
 */

	var $table = $('#table');
    $table.bootstrapTable({
        toolbar: "#toolbar",
        search: true,
        showColumns: true,
        font: 12,
        columns: [{
            "checkbox": true,
        },{
            "field": 'id',
            "title": 'id',
        },{
            "field": 'product_name',
            "title": '产品名称',
            "editable": {
                "mode": "popup",
                "type": 'text',
				"title": 'select',
				"source": [{ value: 1, text: "爱1" }, { value: 2, text: "爱2" }, {value:3,text:"爱3"}],
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        }, {
            "field": 'product_count',
            "title": '数量',
            "editable": {
                "mode": "inline",
                "type": 'text',
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        }, {
            "field": 'single_original_price',
            "title": '原价（单价）/欧元',
            "editable": {
                "mode": "inline",
                "type": 'text',
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        },{
            "field": 'discount',
            "title": '折扣',
            "editable": {
                "mode": "inline",
                "type": 'text',
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        },{
            "field": 'single_buy_price',
            "title": '实价（单价）/欧元',
            "editable": {
                "mode": "inline",
                "type": 'text',
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        },{
            "field": 'total_buy_price',
            "title": '实价（总价）/欧元',
            "editable": {
                "mode": "inline",
                "type": 'text',
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        },{
            "field": 'single_sell_price',
            "title": '售价（单价）/人民币',
            "visible": false,
            "editable": {
                "mode": "inline",
                "type": 'text',
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        },{
            "field": 'total_sell_price',
            "title": '售价（总价）/人民币',
            "visible": false,
            "editable": {
                "mode": "inline",
                "type": 'text',
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        },{
            "field": 'single_profit',
            "title": '利润（单个）/人民币',
            "visible": false,
            "editable": {
                "mode": "inline",
                "type": 'text',
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        },{
            "field": 'total_profit',
            "title": '利润（总）/人民币',
            "visible": false,
            "editable": {
                "mode": "inline",
                "type": 'text',
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        },{
            "field": "date",
            "title": "日期",
            "type": "text",
            "width": "1000px",
            "editable": {
                "type": "date",
                "placement": "bottom",
                "validate": function (v) {
                    if (!v) return '不能为空';  
                }
            }
        }]
    });

    $remove = $("#remove_button")
    $table.on('check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table', function () {
        $remove.prop('disabled', !$table.bootstrapTable('getSelections').length);
        // save your data, here just save the current page
        selections = getIdSelections();
        // push or splice the selections if you want to save all data selections
    });
    
    $remove.click(function(){
    	var ids = getIdSelections();
    	console.log(ids)
    	$table.bootstrapTable("remove", {
    		field: "id",
    		values: ids
    	});
    	 $remove.prop('disabled', true);
    });

    function getIdSelections() {
        return $.map($table.bootstrapTable('getSelections'), function (row) {
            console.log(row.id);
        	return row.id
        });
    }

    var current_date = new Date();
    console.log(current_date.toLocaleDateString());
	var default_data = [{
		"id": 0,
		"product_name": "爱1",
		"product_count": "1",
		"single_original_price": "10",
		"discount": "0.9",
		"single_buy_price": "9",
		"total_buy_price": "9",
		"single_sell_price": "145",
		"total_sell_price": "145",
		"single_profit": "73",
        "total_profit": "73",
        "date": current_date.toLocaleDateString()
	}];
	console.log(default_data[0]["date"]);
	
	var $add_button = $("#add_button");
	$add_button.click(function () {
        td = $table.find("tr").last().find("td").eq(1);
        console.log("td: " + td.text());
        if (isNaN(td)){
			old_id = 0;
        } else {
            old_id = td.text();
        }
        console.log("old_id: " + old_id);
		console.log("before: " + default_data[0]["id"]);
        default_data[0]["id"] = parseInt(old_id) + 1;
        console.log("after: " + default_data[0]["id"]);
		$table.bootstrapTable('append', default_data);
		$table.bootstrapTable('scrollTo', 'bottom');
	});

    var $container = $("div.container")
    console.log($container.prop("tagName"));

  
    $container.on("click", "table th", function() {
    	var name, currency_unit;
    	[name, currency_unit] = $(this).text().split("/");
    	if (currency_unit == "欧元"){
    		var new_text = name +"/"+"人民币";
    	} else if (currency_unit == "人民币"){
    		var new_text = name +"/"+"欧元";
		} else {
			return 
		}
		$(this).find("div.th-inner").text(new_text);
		
		var index = $(this).index();
		$('#table tr').find('td').each(function() {
			if ($(this).index() == index) {
				if (currency_unit == "欧元"){
					$(this).find("a").text(parseFloat($(this).text())*8);
				} else {
					$(this).find("a").text(parseFloat($(this).text())/8);
				}
			}
		});
	});
	
</script>
</body>
</html>
